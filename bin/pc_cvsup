#!/bin/sh
#
# Script to update the Pencil-Code tree from CVS
#
# Update all the necessaries but nothing else.
#  (eg. miss out the runs directory)   
#
add_update_path()
{
  while [ $1 ]; do
    [ -e $1 ] && UPDATE_PATHS="$UPDATE_PATHS $1"
    shift
  done
}

add_update_path_nonewdir()
{
  while [ $1 ]; do
    [ -e $1 ] && UPDATE_PATHS_NONEWDIR="$UPDATE_PATHS_NONEWDIR $1"
    shift
  done
}

if [ ! "$PENCIL_HOME" ]; then
  echo PENCIL_HOME variable not set! Exiting...
  exit 1 
fi
if [ ! -d "$PENCIL_HOME/" ]; then
  echo PENCIL_HOME variable set but is not an existing directory! Exiting...
  exit 1 
fi

while expr "$1" : - >/dev/null; do
  case $1 in
    -a) 
      include_rundirs=1
      shift
    ;;
    --all)
      include_rundirs=1
      shift
  esac
done
cd ${PENCIL_HOME}

EXTRA_ARGS=$@
UPDATE_PATHS="src bin lib idl"
UPDATE_PATHS_NONEWDIR=""

# Conditionally add some other directories to the full update 
#   (if they exist!)
add_update_path samples doc

#  Add other, perhaps personal trees to the shallow update
[ $include_rundirs ] && add_update_path_nonewdir runs pencil-runs
[ $include_rundirs ] && add_update_path_nonewdir tony pencil-tony
[ $include_rundirs ] && add_update_path_nonewdir anders pencil-anders 

# Shallow update other paths in the selected subdirectories 
if [ "$UPDATE_PATHS_NONEWDIR" ]; then
  echo "Updating the subtrees of PENCIL_HOME ($UPDATE_PATHS_NONEWDIR)"
  cvs -q up -P $EXTRA_ARGS $UPDATE_PATHS_NONEWDIR
fi

# Update files in the PENCIL_HOME root
echo "Updating the root of PENCIL_HOME"
cvs -q up -l $EXTRA_ARGS .

# Update files in the selected subdirectories 
echo "Updating the subtrees of PENCIL_HOME ($UPDATE_PATHS)"
cvs -q up -dP $EXTRA_ARGS $UPDATE_PATHS





