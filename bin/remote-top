#!/bin/csh

# Name:   remote-top
# Author: wd+ab
# Date:    7-Oct-2002
# $Id: remote-top,v 1.3 2003-08-28 15:51:24 dobler Exp $
# Description:
#     does top -bn1 on all procs of nodelist, write to datadir

set debug = 0

if ($#argv > 0) then
  if (($1 == "-v") || ($1 == "--verbose")) then
    set debug = 1
    shift
  endif
endif

set targetdir = $PENCIL_WORKDIR/data

# Unpack NODELIST to csh array
set nodelist = `echo "$NODELIST" | sed 's/:/ /g'`

if ($debug) then
  echo "targetdir = $targetdir"
  echo "nodelist = $nodelist"
endif

while (1)
  set i=0
  foreach node ($nodelist)
    if ($debug) echo "node=$node; targetdir=$targetdir"
    $SSH $node "top -bn1 >! $targetdir/proc$i/top.log"
    set i = `expr $i + 1`
    echo 'i=' $i
  end
  sleep 60

end

# End of file
